<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Ping Pong R√©aliste</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: radial-gradient(circle at top, #1a2a3a, #000);
    overflow: hidden;
    font-family: Arial, sans-serif;
    color: white;
}

canvas {
    display: block;
    margin: auto;
    background: linear-gradient(#0b3d2e, #04251c);
    box-shadow: 0 0 30px rgba(0,255,200,0.4);
}

/* UI */
#ui {
    position: absolute;
    top: 10px;
    width: 100%;
    text-align: center;
    font-size: 18px;
}

#gameOver {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.85);
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
}

#gameOver button {
    margin-top: 20px;
    padding: 14px 34px;
    font-size: 18px;
    background: #00ffd5;
    border: none;
    border-radius: 30px;
    cursor: pointer;
}
</style>
</head>

<body>

<div id="ui">
    üèÜ Best: <span id="best">0</span> | üéØ Score: <span id="score">0</span>
</div>

<canvas id="game"></canvas>

<div id="gameOver">
    <h1>üí• Game Over</h1>
    <button onclick="restart()">üîÑ Rejouer</button>
</div>

<!-- Sons -->
<audio id="hit" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.wav"></audio>
<audio id="lose" src="https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-game-over-470.wav"></audio>
<audio id="bgm" src="https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3" loop></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let paddleW = 140;
let paddleH = 18;

let player, ai, ball;
let score = 0;
let best = localStorage.getItem("pongBest") || 0;
document.getElementById("best").innerText = best;

function init(){
    player = { x: canvas.width/2 - paddleW/2, y: canvas.height - 40 };
    ai = { x: canvas.width/2 - paddleW/2, y: 30 };
    ball = {
        x: canvas.width/2,
        y: canvas.height/2,
        r: 10,
        dx: 5,
        dy: 5
    };
    score = 0;
    document.getElementById("score").innerText = score;
    document.getElementById("gameOver").style.display = "none";
    document.getElementById("bgm").volume = 0.4;
    document.getElementById("bgm").play();
}
init();

function drawPaddle(p){
    ctx.fillStyle = "#00ffd5";
    ctx.shadowColor = "#00ffd5";
    ctx.shadowBlur = 15;
    ctx.fillRect(p.x, p.y, paddleW, paddleH);
}

function drawBall(){
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
    ctx.fillStyle = "#fff";
    ctx.shadowBlur = 20;
    ctx.fill();
}

function update(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    drawPaddle(player);
    drawPaddle(ai);
    drawBall();

    ball.x += ball.dx;
    ball.y += ball.dy;

    // Mur
    if(ball.x < ball.r || ball.x > canvas.width - ball.r){
        ball.dx *= -1;
        document.getElementById("hit").play();
    }

    // Raquette joueur
    if(ball.y + ball.r > player.y &&
       ball.x > player.x && ball.x < player.x + paddleW){
        ball.dy *= -1.05;
        score++;
        document.getElementById("score").innerText = score;
        document.getElementById("hit").play();
    }

    // Raquette IA
    if(ball.y - ball.r < ai.y + paddleH &&
       ball.x > ai.x && ball.x < ai.x + paddleW){
        ball.dy *= -1.05;
        document.getElementById("hit").play();
    }

    // IA simple mais fluide
    ai.x += (ball.x - (ai.x + paddleW/2)) * 0.08;

    // Game over
    if(ball.y > canvas.height){
        endGame();
    }
}

function endGame(){
    document.getElementById("bgm").pause();
    document.getElementById("lose").play();
    document.getElementById("gameOver").style.display = "flex";
    if(score > best){
        best = score;
        localStorage.setItem("pongBest", best);
        document.getElementById("best").innerText = best;
    }
}

function restart(){
    init();
}

// Contr√¥le tactile & souris
function movePaddle(x){
    player.x = x - paddleW/2;
    if(player.x < 0) player.x = 0;
    if(player.x + paddleW > canvas.width) player.x = canvas.width - paddleW;
}

canvas.addEventListener("mousemove", e => movePaddle(e.clientX));
canvas.addEventListener("touchmove", e => {
    e.preventDefault();
    movePaddle(e.touches[0].clientX);
},{passive:false});

setInterval(update, 16);
</script>

</body>
</html>
